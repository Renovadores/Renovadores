Project "Ficus Data Base" {
  database_type: 'SQL Server'
  Note: 'Base de datos para la pyme Ficus'
}

Table Usuario {
  id_usuario integer [pk, note: "Identificador del usuario"]
  nombre varchar [not null, note: "Guarda el nombre del usuario"]
  apellidos varchar [not null, note: "Guarda el o los apellidos del usuario"]
  contrasena varchar [not null, note: "Contraseña encriptada del usuario"]
  id_rol integer [note: "Identifica las capacidades del usuario"]
}

Table Rol {
  id_rol integer [pk, note: "Indentificador unico del usuario"]
  tipo_rol varchar [not null, note: "Nombre del rol"]
  detalles_rol varchar [note: "Detalles sobre el rol"]
}

Ref: Usuario.id_rol > Rol.id_rol

Table Producto {
  sku varchar [pk, note: "Identificador unico para cada producto"]
  nombre varchar [note: "Nombre del producto"]
  color integer
  descripcion varchar
  dimensiones varchar
  peso_recipiente integer
  peso_desechable integer 
  alquiler_Comercios integer [note: "Costo para el alquiler a comercio incluyendo IVA"]
  alquiler_Retail integer [note: "Costo para el alquiler a retail incluyendo IVA"]
  categoria integer
  familia integer
  imagen varchar [note: "URL a la imagen del producto"]
}

Table Categoria {
  id_categoria integer [pk]
  nombre_categoria varchar [not null, note: "Nombre de la categoría"]
}

Table Familia {
  id_familia integer [pk]
  nombre_familia varchar [not null, note: "Nombre de un grupo de productos"]
}

Table Color {
  id_color integer [pk]
  descripcion varchar
  Note: "Guarda el color de cada producto"
}

Ref: Producto.categoria > Categoria.id_categoria
Ref: Producto.familia > Familia.id_familia
Ref: Producto.color > Color.id_color


Table Estado {
  id_estado integer [pk]
  descripcion_estadoproducto varchar [not null, note: "Que estado es el actual de un producto"]
}

// Agregar pk compuesto
Table Inventario {
  producto varchar
  estado integer
  cantidad integer
  lote integer
  fecha_ingreso date

  indexes {
    (producto, estado) [pk]
  }
  Note: "Guarda las caracteristicas de cada producto, si está disponible, reservado, etc..."
}

Ref: Inventario.producto > Producto.sku
Ref: Inventario.estado > Estado.id_estado

Table Orden {
  id_orden varchar [pk]
  fecha_alquiler date [not null]
  usuario integer [not null, note: "Responsable de agregar la orden"]
  cliente integer [not null]
  evento integer
  registro_limpieza integer
  limpieza_unidad integer
  limpieza integer
  monto integer [not null]
  descuento integer
}

Table Evento {
  id_evento integer [pk]
  nombre_evento varchar [not null]
  descripcion_evento varchar
}

Ref: Orden.usuario > Usuario.id_usuario
Ref: Orden.cliente > Cliente.id_cliente
Ref: Evento.id_evento < Orden.evento

Table Fase {
  id_fase integer [pk]
  descripcion_estado varchar [not null, note: "Definición de la fase de una orden"]
}

Table Historial_Orden {
  orden varchar [not null]
  fase integer [not null]
  inicio date [not null, note: "Fecha de inicio de la fase actual"]
  final date [not null, note: "Fecha final de la fase actual"]

  indexes {
    (orden, fase) [pk]
  }
  Note: "Guarda en que fase se encuentra cada orden"
}

Ref: Historial_Orden.orden > Orden.id_orden
Ref: Historial_Orden.fase > Fase.id_fase

Table Detalle {
  id_reserva varchar
  producto varchar 
  pedidos integer
  sin_usar integer
  usados integer
  devueltos integer
  descuento integer
  indexes {
    (id_reserva, producto) [pk]
  }
}

Ref: Detalle.id_reserva > Orden.id_orden
Ref: Detalle.producto > Producto.sku

Table Cliente {
  id_cliente integer [pk]
  fecha_agregado date
  responsable integer [note: "Responsable del cliente"]
  prioridad varchar
  estado varchar
  nombre_empresa varchar
  contacto varchar
  telefono integer
  correo varchar
  web varchar
}

Ref: Usuario.id_usuario < Cliente.responsable

Table Segmento {
  id_segmento varchar [pk]
  detalles varchar
}

Table Cliente_Segmento {
  cliente integer [not null]
  segmento varchar [not null]
  indexes {
    (cliente, segmento) [pk]
  }
}

Ref: Cliente_Segmento.cliente > Cliente.id_cliente
Ref: Cliente_Segmento.segmento > Segmento.id_segmento

Table MedioComunicacion {
  id_medio varchar [pk]
  caracteristicas varchar
}

Table Cliente_Comunicacion {
  cliente integer
  medio varchar
  indexes {
    (cliente, medio) [pk]
  }
}

Ref: Cliente_Comunicacion.cliente > Cliente.id_cliente
Ref: Cliente_Comunicacion.medio > MedioComunicacion.id_medio
